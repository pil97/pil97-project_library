<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.library.basic.usr.qna.QnaMapper">

	<!-- QnA 작성 -->
	<insert id="qnaWrite" parameterType="QnaVO">

		INSERT INTO
		qna_table(
		qna_code,
		usr_id,
		book_bno,
		qna_type,
		qna_password,
		qna_title,
		qna_content
		)
		VALUES(
		seq_qna_code.nextval,
		#{usr_id},
		#{book_bno},
		#{qna_type},
		#{qna_password},		
		#{qna_title},
		#{qna_content}
		)
		
	</insert>


	<!-- QnA 목록 -->
	<select id="qnaList" resultType="QnaVO" parameterType="map">

		SELECT
		qna_code,
		usr_id,
		book_bno,
		qna_type,
		qna_password,
		qna_title,
		qna_content,
		qna_update,
		qna_date
		FROM(
		SELECT /*+ INDEX_DESC(qna_table PK_QNA_CODE) */
		ROWNUM AS RN,
		qna_code,
		usr_id,
		book_bno,
		qna_type,
		qna_password,
		qna_title,
		qna_content,
		qna_update,
		qna_date
		FROM
		qna_table
		WHERE
		book_bno = ${book_bno}
		AND
		 <![CDATA[  		
		   		ROWNUM <= (#{cri.pageNum} * #{cri.amount})   -- 페이지번호 * 페이지별 출력건수
		 ]]>
		)
		WHERE
		RN > (#{cri.pageNum} - 1 ) * #{cri.amount}


	</select>

	<!-- QnA 개수 -->
	<select id="getCountQnaByBookBno" resultType="int"
		parameterType="int">

		SELECT
		COUNT(*)
		FROM
		qna_table
		WHERE
		book_bno = #{book_bno}

	</select>
	
	<!-- QnA 상세폼 -->
	<select id="qnaForm" resultType="QnaVO" parameterType="Long">
	SELECT
		qna_code,
		usr_id,
		book_bno,
		qna_type,
		qna_password,
		qna_title,
		qna_content,
		qna_update,
		qna_date
		FROM
		qna_table
		WHERE
		qna_code = #{qna_code}
	</select>


</mapper>