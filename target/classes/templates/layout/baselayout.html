<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
  <head th:replace="~{layout/comm/config :: configFragment}"></head>

  <body>
    <div class="container">
      <div th:replace="~{layout/comm/header :: headerFragment}"></div>
      <div th:replace="~{layout/comm/nav :: navFragment}"></div>

      <th:block layout:fragment="content">
        <!-- 각각의 페이지에서 구현하고자 하는 컨텐츠를 작성 -->
      </th:block>
    </div>

    <div th:replace="~{layout/comm/footer :: footerFragment}"></div>

    <th:block th:replace="~{layout/comm/script :: script}"></th:block>

    <th:block layout:fragment="script">
      <!-- 각각의 페이지에서 필요한 자바스크립트 작성 -->
    </th:block>
    <script th:inline="javascript">
      $(document).ready(function () {
        $(".dropdown-menu a.dropdown-toggle").on("click", function (e) {
          e.preventDefault();
          e.stopPropagation();

          if (!$(this).next().hasClass("show")) {
            $(this).parents(".dropdown-menu").first().find(".show").removeClass("show");
          }

          var $subMenu = $(this).next(".dropdown-menu");

          $subMenu.toggleClass("show");

          $(this)
            .parents("li.nav-item.dropdown.show")
            .on("hidden.bs.dropdown", function (e) {
              $(".dropdown-submenu .show").removeClass("show");
            });

          return false;
        });

        // 1차 카테고리 선택
        $("a#firstCategory").on("click", function (e) {
          e.preventDefault();

          let curFirstCategory = $(this);

          let c_code = $(this).data("c_code");

          // console.log(curFirstCategory);
          // console.log(c_code);

          // return;

          // 2차 카테고리 주소
          let url = "/admin/category/secondcategory/" + c_code;

          $.getJSON(url, function (secondCategoryResult) {
            let str = '<ul class="dropdown-menu" id="secondCategory">';

            for (let i = 0; i < secondCategoryResult.length; i++) {
              str += `<li><a class="dropdown-item" href="#" data-c_code="${secondCategoryResult[i].c_code}">${secondCategoryResult[i].c_name}</a></li>`;
            }

            str += "</ul>";
            // console.log(str);
            // return;
            // curFirstCategory.closest("li").remove();
            curFirstCategory.parents("div#category_menu").append(str);
          });
        });

        // 2차 카테고리 선택
        $("div#category_menu").on("click", "ul#secondCategory li a", function (e) {
          e.preventDefault();

          let c_code = $(this).data("c_code");
          let c_name = encodeURIComponent($(this).html()); // 인코딩 작업 -> & 특수문자 때문에

          console.log("2차 카테고리 코드 : " + c_code);
          console.log("2차 카테고리 이름 : " + c_name);

          return;

          // cat_name=맨투맨&후드티 -> & 특수문자로 인하여 서버에서는 맨투맨 문자열만 인식됨
          location.href = `/product/productlist?cat_code=${cat_code}&cat_name=${cat_name}`;
        });
      });
    </script>
  </body>
</html>
